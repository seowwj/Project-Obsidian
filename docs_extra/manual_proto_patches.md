# Manual Protobuf Patches

Due to compatibility issues between `protoc-gen-grpc-web` and the Vite build setup (CommonJS/ESM interop), we cannot simply regenerate the frontend protobuf files. Instead, we must apply manual patches when new methods are added to the backend `service.proto`.

## Added `GetStatus` (2026-01-08)

### File: `frontend/src/api/service_pb.js`

Add the following request/response message definitions (typically near other message definitions):

```javascript
/**
 * Generated by JsPbCodeGenerator.
 * @param {Array=} opt_data Optional initial data array, typically from a
 * server response, or constructed directly in Javascript. The array is used
 * in place and becomes part of the constructed object. It is not cloned.
 * If no data is provided, the constructed object will be empty, but still
 * valid.
 * @extends {jspb.Message}
 * @constructor
 */
proto.obsidian.GetStatusRequest = function(opt_data) {
  jspb.Message.initialize(this, opt_data, 0, -1, null, null);
};
goog.inherits(proto.obsidian.GetStatusRequest, jspb.Message);
if (goog.DEBUG && !COMPILED) {
  /**
   * @public
   * @override
   */
  proto.obsidian.GetStatusRequest.displayName = 'proto.obsidian.GetStatusRequest';
}

/**
 * Generated by JsPbCodeGenerator.
 * @param {Array=} opt_data Optional initial data array, typically from a
 * server response, or constructed directly in Javascript. The array is used
 * in place and becomes part of the constructed object. It is not cloned.
 * If no data is provided, the constructed object will be empty, but still
 * valid.
 * @extends {jspb.Message}
 * @constructor
 */
proto.obsidian.GetStatusResponse = function(opt_data) {
  jspb.Message.initialize(this, opt_data, 0, -1, null, null);
};
goog.inherits(proto.obsidian.GetStatusResponse, jspb.Message);
if (goog.DEBUG && !COMPILED) {
  /**
   * @public
   * @override
   */
  proto.obsidian.GetStatusResponse.displayName = 'proto.obsidian.GetStatusResponse';
}

// ... (Add serializers/deserializers - copy from UploadRequest pattern but adjust for fields)

if (jspb.Message.GENERATE_TO_OBJECT) {
    proto.obsidian.GetStatusRequest.prototype.toObject = function(opt_includeInstance) {
        return proto.obsidian.GetStatusRequest.toObject(opt_includeInstance, this);
    };
    proto.obsidian.GetStatusRequest.toObject = function(includeInstance, msg) {
        var f, obj = {};
        if (includeInstance) {
            obj.$jspbMessageInstance = msg;
        }
        return obj;
    };
}
proto.obsidian.GetStatusRequest.deserializeBinary = function(bytes) {
    var reader = new jspb.BinaryReader(bytes);
    var msg = new proto.obsidian.GetStatusRequest;
    return proto.obsidian.GetStatusRequest.deserializeBinaryFromReader(msg, reader);
};
proto.obsidian.GetStatusRequest.deserializeBinaryFromReader = function(msg, reader) {
    while (reader.nextField()) {
        if (reader.isEndGroup()) {
            break;
        }
        var field = reader.getFieldNumber();
        switch (field) {
            default:
                reader.skipField();
                break;
        }
    }
    return msg;
};
proto.obsidian.GetStatusRequest.prototype.serializeBinary = function() {
    var writer = new jspb.BinaryWriter();
    proto.obsidian.GetStatusRequest.serializeBinaryToWriter(this, writer);
    return writer.getResultBuffer();
};
proto.obsidian.GetStatusRequest.serializeBinaryToWriter = function(message, writer) {
    var f = undefined;
};


// Response Logic
if (jspb.Message.GENERATE_TO_OBJECT) {
    proto.obsidian.GetStatusResponse.prototype.toObject = function(opt_includeInstance) {
        return proto.obsidian.GetStatusResponse.toObject(opt_includeInstance, this);
    };
    proto.obsidian.GetStatusResponse.toObject = function(includeInstance, msg) {
        var f, obj = {
            modelLoaded: jspb.Message.getBooleanFieldWithDefault(msg, 1, false)
        };
        if (includeInstance) {
            obj.$jspbMessageInstance = msg;
        }
        return obj;
    };
}
proto.obsidian.GetStatusResponse.deserializeBinary = function(bytes) {
    var reader = new jspb.BinaryReader(bytes);
    var msg = new proto.obsidian.GetStatusResponse;
    return proto.obsidian.GetStatusResponse.deserializeBinaryFromReader(msg, reader);
};
proto.obsidian.GetStatusResponse.deserializeBinaryFromReader = function(msg, reader) {
    while (reader.nextField()) {
        if (reader.isEndGroup()) {
            break;
        }
        var field = reader.getFieldNumber();
        switch (field) {
            case 1:
                var value = /** @type {boolean} */ (reader.readBool());
                msg.setModelLoaded(value);
                break;
            default:
                reader.skipField();
                break;
        }
    }
    return msg;
};
proto.obsidian.GetStatusResponse.prototype.serializeBinary = function() {
    var writer = new jspb.BinaryWriter();
    proto.obsidian.GetStatusResponse.serializeBinaryToWriter(this, writer);
    return writer.getResultBuffer();
};
proto.obsidian.GetStatusResponse.serializeBinaryToWriter = function(message, writer) {
    var f = undefined;
    f = message.getModelLoaded();
    if (f) {
        writer.writeBool(1, f);
    }
};

proto.obsidian.GetStatusResponse.prototype.getModelLoaded = function() {
    return /** @type {boolean} */ (jspb.Message.getBooleanFieldWithDefault(this, 1, false));
};
proto.obsidian.GetStatusResponse.prototype.setModelLoaded = function(value) {
    return jspb.Message.setProto3BooleanField(this, 1, value);
};

// FORCE EXPORT (Critical for CommonJS/ESM interop)
// Do NOT use goog.exportSymbol(..., null, global) as it will overwrite the definition with null.
exports.GetStatusRequest = proto.obsidian.GetStatusRequest;
exports.GetStatusResponse = proto.obsidian.GetStatusResponse;
```

### File: `frontend/src/api/service_grpc_web_pb.js`

Add the Method Descriptor and Client Methods:

```javascript
/**
 * @const
 * @type {!grpc.web.MethodDescriptor<
 *   !proto.obsidian.GetStatusRequest,
 *   !proto.obsidian.GetStatusResponse>}
 */
const methodDescriptor_ObsidianService_GetStatus = new grpc.web.MethodDescriptor(
  '/obsidian.ObsidianService/GetStatus',
  grpc.web.MethodType.UNARY,
  messages.GetStatusRequest,
  messages.GetStatusResponse,
  /**
   * @param {!proto.obsidian.GetStatusRequest} request
   * @return {!Uint8Array}
   */
  function(request) {
    return request.serializeBinary();
  },
  messages.GetStatusResponse.deserializeBinary
);

/**
 * @param {!proto.obsidian.GetStatusRequest} request The
 *     request proto
 * @param {?Object<string, string>} metadata User defined
 *     call metadata
 * @param {function(?grpc.web.RpcError, ?proto.obsidian.GetStatusResponse)}
 *     callback The callback function(error, response)
 * @return {!grpc.web.ClientReadableStream<!proto.obsidian.GetStatusResponse>|undefined}
 *     The XHR Node Readable Stream
 */
proto.obsidian.ObsidianServiceClient.prototype.getStatus =
  function(request, metadata, callback) {
    return this.client_.rpcCall(this.hostname_ +
      '/obsidian.ObsidianService/GetStatus',
      request,
      metadata || {},
      methodDescriptor_ObsidianService_GetStatus,
      callback);
  };

/**
 * @param {!proto.obsidian.GetStatusRequest} request The
 *     request proto
 * @param {?Object<string, string>=} metadata User defined
 *     call metadata
 * @return {!Promise<!proto.obsidian.GetStatusResponse>}
 *     Promise that resolves to the response
 */
proto.obsidian.ObsidianServicePromiseClient.prototype.getStatus =
  function(request, metadata) {
    return this.client_.unaryCall(this.hostname_ +
      '/obsidian.ObsidianService/GetStatus',
      request,
      metadata || {},
      methodDescriptor_ObsidianService_GetStatus);
  };
```
